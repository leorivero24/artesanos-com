doctype html
html(lang="es")
    head
        meta(charset="UTF-8")
        meta(name="viewport" content="width=device-width, initial-scale=1.0")
        title Recuperar Contraseña - artesanos.com
        link(rel="stylesheet" href="/css/olvide-contrasena.css")
        link(href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet")
        // ✨ ATENCIÓN AQUÍ: La línea 'style.' NO DEBE TENER LA MISMA INDENTACIÓN que el 'link' inmediatamente superior.
        // Debería estar al mismo nivel que 'link' y 'title', es decir, solo 4 espacios después de 'head'.
        //- style.
        //-     /* Puedes añadir estilos específicos aquí si quieres */
        //-     .reset-container {
        //-         max-width: 400px;
        //-         margin: 50px auto;
        //-         padding: 30px;
        //-         background: #f9f5f0; /* beige muy claro */
        //-         border-radius: 8px;
        //-         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        //-         text-align: center;
        //-     }
        //-     .reset-container h1 {
        //-         font-family: 'Pacifico', cursive;
        //-          color: #8b5e3c; /* marrón cálido */
        //-     margin-bottom: 20px;
            
        //-     }
        //-     .reset-container p {
        //-         margin-bottom: 20px;
        //-         color: #666;
        //-     }
        //-     .reset-container input[type="email"] {
        //-         width: calc(105% - 22px); /* Ancho del input */
        //-         padding: 10px;
        //-         margin-bottom: 15px;
        //-         border: 1px solid #ddd;
        //-         border-radius: 5px;
        //-     }
        //-     .reset-container input[type="email"]:focus {
        //-          outline: none;
        //-         border-color: #8b5e3c;
        //-           box-shadow: 0 0 8px #8b5e3caa;
        //-         background: #fffdf7;
        //-     }
        //-     .reset-container button {
        //-        background: #8b5e3c;
        //-         color: white;
        //-         padding: 10px 20px;
        //-         border: none;
        //-         border-radius: 5px;
        //-         cursor: pointer;
        //-         font-size: 16px;
        //-     }
        //-     .reset-container button:hover {
        //-           background: #7a4f2e;
        //-          transform: translateY(-2px);
        //-     }
        //-     .back-to-login {
        //-         margin-top: 25px;
        //-          color: #6a5c48;
        //-         font-size: 0.9em;
        //-     }
        //-     .back-to-login a {
        //-         color: #8b5e3c;
        //-         text-decoration: none;
        //-     }
        //-     .back-to-login a:hover {
        //-         text-decoration: underline;
        //-     }
        //-     #mensaje {
        //-         margin-top: 15px;
        //-         font-weight: bold;
        //-     }

    body
        .reset-container
            h1 Recuperar Contraseña
            p Ingresa tu correo electrónico para recibir un enlace de restablecimiento de contraseña.
            form#solicitarRestablecimientoForm(action="/solicitar-restablecimiento" method="POST")
                input(type="email" id="email" name="email" placeholder="Correo electrónico", required)
                button(type="submit") Enviar Enlace

                p#mensaje(style="display: none;")

            p.back-to-login
                a(href="/login") Volver al Login

        script.
            const solicitarRestablecimientoForm = document.getElementById('solicitarRestablecimientoForm');
            const emailInput = document.getElementById('email');
            const mensajeElement = document.getElementById('mensaje');

            solicitarRestablecimientoForm.addEventListener('submit', async function(event) {
                event.preventDefault();

                mensajeElement.style.display = 'none';
                mensajeElement.textContent = '';
                mensajeElement.style.color = 'black'; // Reset color

                const email = emailInput.value.trim();

                if (!email) {
                    mensajeElement.textContent = 'Por favor, ingresa tu correo electrónico.';
                    mensajeElement.style.color = 'red';
                    mensajeElement.style.display = 'block';
                    return;
                }

                try {
                    const response = await fetch('/solicitar-restablecimiento', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email: email })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        mensajeElement.textContent = data.mensaje || 'Se ha enviado un enlace de restablecimiento a tu correo electrónico. Por favor, revisa tu bandeja de entrada.';
                        mensajeElement.style.color = 'green';
                    } else {
                        mensajeElement.textContent = data.mensaje || 'Hubo un error al procesar tu solicitud.';
                        mensajeElement.style.color = 'red';
                    }
                    mensajeElement.style.display = 'block';

                } catch (error) {
                    console.error('Error al enviar la solicitud de restablecimiento:', error);
                    mensajeElement.textContent = 'Error de conexión. Inténtalo de nuevo más tarde.';
                    mensajeElement.style.color = 'red';
                    mensajeElement.style.display = 'block';
                }
            });